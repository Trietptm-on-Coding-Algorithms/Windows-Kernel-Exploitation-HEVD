### Windows Kernel Exploit development practice - HEVD
### Windows 7 x86 exploits

----

My implementation of exploits for the [HackSysExtremeVulnerableDriver](https://github.com/hacksysteam/HackSysExtremeVulnerableDriver) project.

#### Exploits : 

| Vulnerability | Status        | Link  | 
| ------------- |:-------------:| ------|
|*Stack Overflow* | Finished | https://fullpwnops.com/HEVD-kernel-overflow |
|*Write-what-where*| In-progress |  |
|*Type Confusion*  | Finished    | https://fullpwnops.com/HEVD-typeconfusion |
|*Null Pointer Dereference* | Finished | https://fullpwnops.com/HEVD_null-pointer |

1. **Stack Overflow** - privilege escalation

This privilege escalation exploit takes advantage of a stack-based vulnerability within the HEVD program. We can use the CreateFileA() function to establish the HEVD driver device which we can then use the DeviceIoControl() function to pass data to the IOCTL we found with IDA and calculated from the .h file with Python (located at 0x222003). Since we need to communicate with the HEVD driver (in kernel-land) from user-land.

To escalate our privileges we can use the supplied token stealing shellcode which steals the NT Authority / System token and we will have it spawn a new CMD process with elevated privileges.

![EOP](https://raw.githubusercontent.com/x00pwn/Windows-Kernel-Exploitation-HEVD/master/images/HEVD_stack-overflow.png)

----

2. **Arbitrary Memory Overwrite (Write-What-Where)** - privilege escalation

This privilege escalation exploit takes advantage of a "Write-What-Where" vulnerability in the HEVD program. 

3. **Type Confusion Bug**

This privilege escalation exploit takes advantage of a "Type confusion bug" vulnerability in the HEVD program via sending a pointer of the shellcode token stealing payload to the driver via a discovered IOCTL from the driver.

![EOP](https://raw.githubusercontent.com/FULLSHADE/FULLSHADE.github.io/master/static/img/_posts/typeconfusion_eop.png)


4. **Null Pointer Dereference** - privilege escalation

This privilege escalation exploit takes advantage of a NULL Pointer Dereference vulnerability in the HEVD driver, an attacker has the ability to send data via the IOCTL code 0x22202b, then proceeding to allocate and write a pointer to their shellcode payload via the `NtAllocateVirtualMemory` and `WriteProcessMemory` functions.

![EOP](https://raw.githubusercontent.com/FULLSHADE/Windows-Kernel-Exploitation-HEVD/master/images/hevd-null-ptr-shell.png)
